!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d}b.exports=d},{}],2:[function(a,b,c){function d(a,b,c,d){this.type=a,this.direction=b,this.x=c,this.y=d}d.prototype.serialize=function(){return{type:this.type,direction:this.direction,x:this.x,y:this.y}},d.prototype.forEachBlock=function(a){var b,c=0,d=0,e=this.type.blocks[this.direction];for(b=32768;b>0;b>>=1)e&b&&a(this.x+d,this.y+c,this.type),4===++d&&(d=0,++c)},b.exports=d},{}],3:[function(a,b,c){var d={direction:{UP:0,RIGHT:1,DOWN:2,LEFT:3,MIN:0,MAX:3},block:{WIDTH:25,HEIGHT:25},court:{WIDTH:12,HEIGHT:20},get WIDTH(){return this.block.WIDTH*this.court.WIDTH},get HEIGHT(){return this.block.HEIGHT*this.court.HEIGHT}};b.exports=d},{}],4:[function(a,b,c){var d=a("./phaser"),e=a("./phaser-game"),f=a("./game-config"),g=new d.Game(f.WIDTH,f.HEIGHT,d.CANVAS,"");g.state.add("Game",e,!0)},{"./game-config":3,"./phaser":6,"./phaser-game":5}],5:[function(a,b,c){function d(a){var b;for(b=0;b<=f.court.WIDTH;b++)a.push(new i.Line(b*f.block.WIDTH,0,b*f.block.WIDTH,f.HEIGHT));for(b=0;b<=f.court.HEIGHT;b++)a.push(new i.Line(0,b*f.block.HEIGHT,f.WIDTH,b*f.block.HEIGHT))}var e=a("./tetris-core"),f=a("./game-config"),g=a("./block"),h=a("./figure"),i=a("./phaser");g.prototype.render=function(){return new i.Rectangle(this.x,this.y,this.width,this.height)};var j=function(){},k={37:"moveLeft",38:"rotate",39:"moveRight",40:"moveDown"};j.prototype={init:function(){console.log("Init"),this.cursors=null,this.elems=[],e=new e(f,g,h)},preload:function(){console.log("Preload"),d(this.elems)},create:function(){console.log("Create"),this.input.keyboard.onUpCallback=function(a){var b=k[a.keyCode];b&&e.trigger(b)}.bind(this),e.run(),e.setCurrentPiece()},update:function(){e.update(this._deltaTime)},render:function(){var a=e.getAllBlocks();this.elems.forEach(function(a){this.game.debug.geom(a)}.bind(this)),a.forEach(function(a){this.game.debug.geom(a.render())}.bind(this))}},b.exports=j},{"./block":1,"./figure":2,"./game-config":3,"./phaser":6,"./tetris-core":7}],6:[function(a,b,c){b.exports=window.Phaser},{}],7:[function(a,b,c){function d(a,b){return Math.floor(a+Math.random()*b)}function e(a,b,c){this.validate(a,b,c),this.Config=a,this.BlockClass=b,this.FigureClass=c,this._events={},this.currentPiece=null,this.running=!1,this.blocks={},this.pieces={i:{id:"i",size:4,blocks:[240,17476,240,17476]},j:{id:"j",size:3,blocks:[17600,36352,25664,3616]},l:{id:"l",size:3,blocks:[17504,3712,50240,11776]},o:{id:"o",size:2,blocks:[52224,52224,52224,52224]},s:{id:"s",size:3,blocks:[1728,17952,1728,17952]},t:{id:"t",size:3,blocks:[3648,19520,19968,17984]},z:{id:"z",size:3,blocks:[3168,9792,3168,9792]}},this.piecesLeft=["i","i","i","i","j","j","j","j","l","l","l","l","o","o","o","o","s","s","s","s","t","t","t","t","z","z","z","z"],this.listen(),this.__frames=0,this.__FPSMod=10}e.prototype.listen=function(){this.on("rotate",function(){this.rotateCurrent()}.bind(this)),this.on("moveLeft",function(){this.moveCurrent(this.Config.direction.LEFT)}.bind(this)),this.on("moveRight",function(){this.moveCurrent(this.Config.direction.RIGHT)}.bind(this)),this.on("moveDown",function(){this.__FPSMod=0}.bind(this))},e.prototype.validate=function(a,b,c){if(!a||!b||!c)throw new Error("Missing Config, BlockClass or FigureClass")},e.prototype.on=function(a,b){console.log("listening to event:",a),this._events[a]||(this._events[a]=[]),this._events[a].push(b)},e.prototype.trigger=function(a,b){console.log("triggering event:",a,b),this._events[a]&&this._events[a].forEach(function(a){a.call(this,b)}.bind(this))},e.prototype.run=function(){this.running=!0},e.prototype.pause=function(){this.running=!1},e.prototype.placeAvailableFor=function(a){var b=!0;return a.forEachBlock(function(a,c){(0>a||a>=this.Config.court.WIDTH||c>=this.Config.court.HEIGHT||this.getBlockFromPosition(a,c))&&(b=!1)}.bind(this)),b},e.prototype.randomFigure=function(){0===this.piecesLeft.length&&(this.piecesLeft=["i","i","i","i","j","j","j","j","l","l","l","l","o","o","o","o","s","s","s","s","t","t","t","t","z","z","z","z"]);var a=this.pieces[this.piecesLeft.splice(d(0,this.piecesLeft.length-1),1)];return new this.FigureClass(a,this.Config.direction.UP,Math.round(d(0,this.Config.court.WIDTH-a.size)),-4)},e.prototype.placeFigure=function(){var a=this.getCurrent();a.forEachBlock(function(a,b,c){this.placeBlock(a,b,c),this.__FPSMod=10,0>=b&&(this.pause(),this.trigger("gameOver"))}.bind(this))},e.prototype.getCurrent=function(){return this.currentPiece},e.prototype.setCurrentPiece=function(a){this.currentPiece=a||this.randomFigure()},e.prototype.getBlockFromPosition=function(a,b){return this.blocks[a]?this.blocks[a][b]:null},e.prototype.placeBlock=function(a,b,c){this.blocks[a]||(this.blocks[a]={}),this.blocks[a][b]=c},e.prototype.getCurrentBlocks=function(){var a=this.getCurrent(),b=[];return a.forEachBlock(function(a,c,d){b.push(this.createBlock(a,c,d.color))}.bind(this)),b},e.prototype.getPlacedBlocks=function(){for(var a,b=[],c=0;c<this.Config.court.HEIGHT;c++)for(var d=0;d<this.Config.court.WIDTH;d++)a=this.getBlockFromPosition(d,c),a&&b.push(this.createBlock(d,c,a.color));return b},e.prototype.createBlock=function(a,b){return new this.BlockClass(a*this.Config.block.WIDTH,b*this.Config.block.HEIGHT,this.Config.block.WIDTH,this.Config.block.HEIGHT)},e.prototype.rotateCurrent=function(){var a,b,c=this.getCurrent();c&&(a=c.serialize(),b=new this.FigureClass(a.type,a.direction,a.x,a.y),c.direction=c.direction===this.Config.direction.MAX?this.Config.direction.MIN:c.direction+1,this.placeAvailableFor(c,"rotate")||this.setCurrentPiece(b))},e.prototype.moveCurrent=function(a){var b=this.getCurrent(),c=b.serialize(),d=new this.FigureClass(c.type,c.direction,c.x,c.y);switch(a){case this.Config.direction.RIGHT:b.x+=1;break;case this.Config.direction.LEFT:b.x-=1;break;case this.Config.direction.DOWN:b.y+=1}return this.placeAvailableFor(b)?!0:(this.setCurrentPiece(d),!1)},e.prototype.placeCurrent=function(){var a=this.getCurrent();a.place=!0},e.prototype.handleLines=function(){var a,b,c,d=0;for(b=this.Config.court.HEIGHT;b>0;--b){for(c=!0,a=0;a<this.Config.court.WIDTH;++a)this.getBlockFromPosition(a,b)||(c=!1);c&&(this.removeLine(b),b+=1,d++)}d>0&&this.trigger("scored",d)},e.prototype.removeLine=function(a){var b,c;for(c=a;c>=0;--c)for(b=0;b<this.Config.court.WIDTH;++b)this.placeBlock(b,c,0===c?null:this.getBlockFromPosition(b,c-1))},e.prototype.shouldUpdate=function(){return this.__frames>this.__FPSMod?(this.__frames=0,!0):(this.__frames++,!1)},e.prototype.update=function(a){this.running&&this.shouldUpdate(a)&&(this.moveCurrent(this.Config.direction.DOWN)||(this.placeFigure(),this.handleLines(),this.setCurrentPiece()))},e.prototype.getAllBlocks=function(){var a=this.getCurrentBlocks(),b=this.getPlacedBlocks();return a?a.concat(b):b},b.exports=e},{}]},{},[4]);